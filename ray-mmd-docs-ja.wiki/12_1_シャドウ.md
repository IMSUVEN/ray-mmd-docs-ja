# 12.シャドウ

Shadowフォルダには、PSSM用とSSAO用の２種類のfxファイルがあります。  

## PSSM1～4.fx
ray-mmdのPSSMは太陽光の影を作るのに利用されています。  
PSSM1～4.fxのfxファイルが有りますが、ユーザーが特に変更をする必要はありません。

* PSSM(Parallel-Split Shadow Maps)
PSSM(Parallel-Split Shadow Maps)はシャドウマップを使用した技術の一つで、幾つかのシャドウマップをカメラからの距離で分割して使用することにより、シャドウマップの解像度不足によるジャギーの発生を抑える効果があります。  
[参考：NVIDIA GPU Gems 3](https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch10.html)  



## SSAO visibility 0.0～1.0.fx
SSAO visibility 0.0～1.0.fxのfxファイルが有ります。  
　これらはSSAOの濃さを調整するもので、デフォルトで「SSAOMap」に`SSAO visibility 1.0.fx`が割り当てられますが、他のものに変更することにより、SSAOの濃さのデフォルトを調整できます。  
また、fxファイル内の `static const float visibility` の値を調整することにより、オリジナルの設定を作ることができます。

* SSAO(Screen Space Ambient Occlusion)はアンビエントオクルージョン(Ambient Occlusion)を再現する技法の一つです。  
アンビエントオクルージョンは凹みや折り目など、光が届きにくい所が暗いままの現象です。

| SSAO visibility 1.0 | SSAO visibility 0.5 | SSAO visibility 0.0 |
| :- | :- | :- |
| [![12_1_SSAOvisibility_10](images/12_1_SSAOvisibility_10.png)](images/12_1_SSAOvisibility_10.png) | [![12_1_SSAOvisibility_05](images/12_1_SSAOvisibility_05.png)](images/12_1_SSAOvisibility_05.png) | [![12_1_SSAOvisibility_00](images/12_1_SSAOvisibility_00.png)](images/12_1_SSAOvisibility_00.png) |

* 参考  
　MMDのキャクターモデルで、白目部分が凹んでいるモデルは割りと多く見受けられます。MMD標準のレンダリングであれば、そのまま白く描画されるので問題は無いのですが、SSAOを使ったり、リアル系のシェーディングをした時には、黒くなってしまいます。  
　その場合、白目の材質のみに `SSAO visibility 0.0.fx` を割り当てて、SSAOを描画しないという方法もあります。  
　さらに、白目のマテリアルを `Emissive` で、わずかに光らせるという方法もあります。

| 白目調整無し | 白目Emissiveマテリアル割り当て | 白目Emissiveマテリアル割り当て + SSAO visibility 0.0 |
| :- | :- | :- |
| [![12_2_SSAOvisibility_0](images/12_2_SSAOvisibility_0.png)](images/12_2_SSAOvisibility_0.png) | [![12_2_SSAOvisibility_1](images/12_2_SSAOvisibility_1.png)](images/12_2_SSAOvisibility_1.png) | [![12_2_SSAOvisibility_2](images/12_2_SSAOvisibility_2.png)](images/12_2_SSAOvisibility_2.png) |

-----

<small> Model : Hatsune Miku V4X Model by Digitrevx </small>